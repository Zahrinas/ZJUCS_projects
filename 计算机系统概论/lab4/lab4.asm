.ORIG x0200
LD R6, OS_SP
LD R0, USER_PSR
ADD R6, R6, #-1
STR R0, R6, #0
LD R0, USER_PC
ADD R6, R6, #-1
STR R0, R6, #0
LD R0, SETBIT
LDI R1, KBSR
NOT R1, R1
NOT R0, R0
AND R0, R0, R1
NOT R0, R0
STI R0, KBSR
LD R0, INTADDR
LD R1, ALTADDR
STR R1, R0, #0
RTI

OS_SP .FILL x3000
USER_PSR .FILL x8002
USER_PC .FILL x3000
SETBIT .FILL x4000
KBSR .FILL xFE00
INTADDR .FILL x0180
ALTADDR .FILL x2000
.END

.ORIG x2000
ST R0, SAVER0
ST R1, SAVER1

LDI R0, KBDR
LD R1, N_BORDER
ADD R1, R0, R1
BRN NUMBER

STI R0, INTPRINT
BRNZP RETINT

NUMBER
LD R1, N_48
ADD R0, R0, R1
LDI R1, INTLOC
ADD R1, R1, R0
LD R0, N_18
ADD R0, R0, R1
BRN NONSHRINK
AND R1, R1, #0
ADD R1, R1, #9
ADD R1, R1, #8
NONSHRINK
ADD R1, R1, #1
STI R1, INTLOC

RETINT
LD R0, SAVER0
LD R1, SAVER1
RTI
SAVER0 .FILL x0000
SAVER1 .FILL x0000
KBDR .FILL xFE02
INTLOC .FILL x3100
INTPRINT .FILL x3101
N_BORDER .FILL xFFC0;0040
N_48 .FILL xFFD0;0030
N_18 .FILL xFFEE;0012
.END

.ORIG x3000
AND R1, R1, #0
ADD R1, R1, #6
STI R1, LOC
LD R1, CHAR_a
STI R1, PRINT

LOOP
LDI R1, LOC
ADD R1, R1, #0
BRZ NODOWN
ADD R1, R1, #-1
STI R1, LOC
NODOWN
NOT R1, R1
ADD R1, R1, #1
LDI R2, PRINT
AND R3, R3, #0

LOOPR
ADD R0, R3, R1
BRZ PCHAR
LD R0, CHAR_POINT
TRAP x21
BRNZP RELOOPR

PCHAR
LDI R0, PRINT
TRAP x21
TRAP x21
TRAP x21
ADD R3, R3, #2

RELOOPR
ADD R3, R3, #1
LD R0, N_20
ADD R0, R0, R3
BRN LOOPR

AND R0, R0, #0
ADD R0, R0, #10
TRAP x21
LD R0, LOOPCOUNT
LOOPDELAY
ADD R0, R0, #-1
BRP LOOPDELAY
BRNZP LOOP

LOOPCOUNT .FILL x0F00
CHAR_POINT .FILL x002E
CHAR_a .FILL x0061
LOC .FILL x3100
PRINT .FILL x3101
N_20 .FILL xFFEC;0014
.END